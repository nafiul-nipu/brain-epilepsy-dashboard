<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>D3 Bar Chart with Circles</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      .bar {
        fill: steelblue;
      }

      .bar:hover {
        fill: brown;
      }

      .axis--x path {
        display: none;
      }

      .circle {
        fill: white;
        stroke: steelblue;
        stroke-width: 2;
      }
    </style>
  </head>
  <body>
    <script>
      // Data
      var data = [
        { x: "A", y: 10 },
        { x: "B", y: 20 },
        { x: "C", y: 30 },
        { x: "D", y: 40 },
        { x: "E", y: 50 },
      ];

      // Setup
      var margin = { top: 20, right: 20, bottom: 30, left: 40 },
        width = 960 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

      var xd = data.map((d) => {
        return d.x;
      });
      console.log(xd);
      var x = d3.scaleBand().range([0, width]).domain(xd).padding(0.1);

      var y = d3.scaleLinear().domain([0, 50]).range([height, 0]);

      var svg = d3
        .select("body")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // Create Bars
      var bar = svg
        .selectAll(".bar")
        .data(data)
        .enter()
        .append("g")
        .attr("class", "bar")
        .attr("transform", function (d) {
          console.log(x(d.x));
          return "translate(" + x(d.x) + ",0)";
        });

      bar
        .selectAll("circle")
        .data(function (d) {
          var circles = [];
          for (var i = 0; i < d.y; i++) {
            circles.push(i);
          }
          return circles;
        })
        .enter()
        .append("circle")
        .attr("class", "circle")
        .attr("cx", function (d) {
          return x.bandwidth() / 2;
        })
        .attr("cy", function (d) {
          return y(d) + 10;
        })
        .attr("r", 4);

      // Create Axes
      x.domain(
        data.map(function (d) {
          return d.x;
        })
      );
      y.domain([
        0,
        d3.max(data, function (d) {
          return d.y;
        }),
      ]);

      svg
        .append("g")
        .attr("class", "axis axis--x")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      svg
        .append("g")
        .attr("class", "axis axis--y")
        .call(d3.axisLeft(y).ticks(10));
    </script>
  </body>
</html>
